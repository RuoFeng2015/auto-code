var Ne=Object.defineProperty,we=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var H=(l,r,a)=>r in l?Ne(l,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[r]=a,E=(l,r)=>{for(var a in r||(r={}))Ue.call(r,a)&&H(l,a,r[a]);if(j)for(var a of j(r))Te.call(r,a)&&H(l,a,r[a]);return l},I=(l,r)=>we(l,Re(r));var h=(l,r,a)=>new Promise((d,x)=>{var A=f=>{try{_(a.next(f))}catch(m){x(m)}},k=f=>{try{_(a.throw(f))}catch(m){x(m)}},_=f=>f.done?d(f.value):Promise.resolve(f.value).then(A,k);_((a=a.apply(l,r)).next())});import{T as G,B as Ie}from"./TableAction.f4a71aa5.js";import{h as S,d as Le,u as ze,E as qe,R as v,F as Pe,A as Me,G as Ke}from"./index.90881ba4.js";import{d as Ve}from"./organization_list.87e216b8.js";import{u as Oe,B as $e}from"./useForm.47f43cbf.js";import{f as je}from"./dateUtil.e0ac7f3e.js";import{d as He,a3 as Ge,a4 as We,f as g,k as B,h as W,g as Xe,o as X,c as Ze,V as o,X as t,u as n,_ as Je,bN as Qe,Z as Ye,bh as C,t as Z,a as Y,aF as J,a2 as eu,N as uu,ah as ou,az as tu,b5 as lu,av as nu,b3 as au,aj as su,aU as ru,ai as cu}from"./vendor.b23ac7e6.js";import"./useDesignSetting.37c45417.js";import"./index.esm.f571281f.js";function iu(l){return S.request({url:"system/role/roleList",method:"POST",params:l})}function du(l){return S.request({url:"system/role/create",method:"POST",params:l})}function fu(l){return S.request({url:"system/role/roleMenuUpdate",method:"POST",params:l})}function pu(l){return S.request({url:`system/role/delete/${l}`,method:"get"})}function Q(l){return S.request({url:"system/role/update",method:"POST",params:l})}const mu=Y("div",{class:"n-layout-page-header"},null,-1),gu=C(" \u6DFB\u52A0\u89D2\u8272 "),_u={class:"py-3 menu-list"},Fu=C("\u63D0\u4EA4"),hu=C(" \u53D6\u6D88 "),vu=C("\u63D0\u4EA4"),Au=He({setup(l){const{hasPermission:r}=Le(),a=ze(),d=Ge(),x=We(),A=g(null),k=g(),_=g(!1),f=g(!1),m=g(!1),N=g(!1),L=g(""),T=g("\u6DFB\u52A0\u89D2\u8272"),D=g([]),F=g(["console","step-form"]),ee=()=>({roleName:"",roleDesc:"",status:0,appId:"",orgCode:"",orgName:""}),ue={roleName:{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:"blur"},roleDesc:{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0",trigger:"blur"},appId:{required:!0,message:"\u8BF7\u9009\u62E9\u5E73\u53F0",trigger:"change",type:"number"},status:{required:!0,message:"\u8BF7\u9009\u62E9\u505C\u542F\u7528",trigger:"change"}},p=B({orgList:[],allOrgList:[],tenantList:[],menus:[]}),oe=B([{field:"name",component:"NInput",label:"\u89D2\u8272\u540D\u79F0",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",onInput:e=>{w.roleName=e,console.log(e)}}},{field:"type",component:"NSelect",label:"\u8D26\u53F7\u72B6\u6001",componentProps:{placeholder:"\u8BF7\u9009\u62E9\u8D26\u53F7\u72B6\u6001",options:[{label:"\u542F\u7528",value:0},{label:"\u505C\u7528",value:1}],onUpdateValue:e=>{console.log(e),w.status=e}}}]),[te,{}]=Oe({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:80,schemas:oe});let b=0,s=B(ee());const z=()=>({roleName:"",status:-1,orgId:a.info.orgId});let w=B(z());const le=()=>h(this,null,function*(){let e=yield Me({pageNumber:1,pageSize:999999});console.log("%c \u{1F34B} res: ","font-size:20px;background-color: #93C0A4;color:#fff;",e),p.menus=e.data.menus,q(p.menus),console.log("%c \u{1F362}  state.menus: ","font-size:20px;background-color: #FCA650;color:#fff;",p.menus)});function q(e){e.map(u=>{u.children.length===0?delete u.children:u.children.length>0&&q(u.children)})}le();const ne=[{title:"id",key:"id"},{title:"\u89D2\u8272\u540D\u79F0",key:"roleName"},{title:"\u89D2\u8272\u63CF\u8FF0",key:"roleDesc"},{title:"\u521B\u5EFA\u4EBA",key:"creator"},{title:"\u72B6\u6001",key:"status",render(e){return W(J,{value:e.status===0,disabled:!r(["edit_role"]),onUpdateValue:u=>h(this,null,function*(){console.log("%c \u{1F36B} message: ","font-size:20px;background-color: #ED9EC7;color:#fff;",d);const{code:i}=yield Q({id:e.id,status:u?0:1});i===v.SUCCESS?(d.success("\u64CD\u4F5C\u6210\u529F"),e.status=e.status===0?1:0):d.error("\u64CD\u4F5C\u5931\u8D25")})})}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"createTime",render(e){return je(e.updateTime)}}],ae=B({width:250,title:"\u64CD\u4F5C",key:"action",fixed:"right",render(e){return W(G,{style:"button",actions:[{label:"\u83DC\u5355\u6743\u9650",onClick:De.bind(null,e),type:"primary",ifShow:()=>!0,auth:["edit_auth"]},{label:"\u7F16\u8F91",type:"info",onClick:ge.bind(null,e),ifShow:()=>!0,auth:["edit_role"]},{label:"\u5220\u9664",type:"error",onClick:ve.bind(null,e),ifShow:()=>!0,auth:["delete_role"]}]})}}),se=e=>h(this,null,function*(){console.log("%c \u{1F32E} res: ","font-size:20px;background-color: #ED9EC7;color:#fff;",e);let u=E(E({},n(w)),e);return yield iu(u)});function re(e){console.log(e)}function ce(e){console.log(e),R()}function ie(e){console.log("3",e),w=z(),k.value.reload()}function R(){k.value.reload()}function de(e){e.preventDefault(),m.value=!0,A.value.validate(u=>{if(u)d.error("\u8BF7\u586B\u5199\u5B8C\u6574\u4FE1\u606F");else{let i=I(E({},s),{appId:s.appId+""});b>0?fe(i):pe(i)}})}function fe(e){Q(I(E({},e),{id:b})).then(u=>{u.code===v.SUCCESS?(f.value=!1,d.success("\u7F16\u8F91\u6210\u529F"),R()):d.error(u.message),m.value=!1})}function pe(e){du(e).then(u=>{console.log("%c \u{1F37E} res: ","font-size:20px;background-color: #7F2B82;color:#fff;",u),u.code===v.SUCCESS?(f.value=!1,d.success("\u65B0\u5EFA\u6210\u529F"),R()):d.error(u.message),m.value=!1,console.log("%c \u{1F964} res: ","font-size:20px;background-color: #465975;color:#fff;",u)})}function me(){m.value=!0,console.log("%c \u{1F376} checkedKeys: ","font-size:20px;background-color: #FCA650;color:#fff;",F.value),fu({roleId:b,menuIds:F.value}).then(e=>{m.value=!1,e.code===v.SUCCESS?(d.success("\u64CD\u4F5C\u6210\u529F"),_.value=!1):d.error(e.message),console.log("%c \u{1F95D} res: ","font-size:20px;background-color: #2EAFB0;color:#fff;",e)})}function ge(e){console.log("\u70B9\u51FB\u4E86\u7F16\u8F91",e),T.value="\u7F16\u8F91\u89D2\u8272",f.value=!0,b=e.id,s.roleDesc=e.roleDesc,s.roleName=e.roleName,s.status=e.status,s.appId=Number(e.appId)}function _e(){T.value="\u65B0\u5EFA\u89D2\u8272",f.value=!0,s.roleDesc="",s.roleName="",s.status=1,b=0}Fe();function Fe(){return h(this,null,function*(){const e=yield qe({pageNumber:1,pageSize:999999});console.log("%c \u{1F34B} getTenantList: ","font-size:20px;background-color: #4b4b4b;color:#fff;",e),e.code===v.SUCCESS&&(p.tenantList=e.data,p.tenantList.map(u=>{u.label=u.tenantName,u.value=u.id}))})}function he(e){P(e),console.log("%c \u{1F364} e: ","font-size:20px;background-color: #FFDD4D;color:#fff;",e)}P();function P(e=null){return h(this,null,function*(){let u={};e?u.appId=e:u.deptId=a.info.orgId;const i=yield Ve({dto:u});console.log("%c \u{1F370} res: ","font-size:20px;background-color: #E41A6A;color:#fff;",i),i.code===v.SUCCESS&&(p.orgList=i.data,M(p.orgList),console.log("%c \u{1F34B}  state.orgList: ","font-size:20px;background-color: #EA7E5C;color:#fff;",p.orgList))})}function M(e){e.map(u=>{var i;u.label=u.orgName,u.value=u.id,u.children&&((i=u.children)==null?void 0:i.length)>0&&M(u.children),u.children&&u.children.length===0&&delete u.children})}function ve(e){x.warning({title:"\u8B66\u544A",content:"\u5220\u9664\u540E\u4E0D\u53EF\u6062\u590D\uFF0C\u786E\u5B9A\u5220\u9664\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{pu(e.id).then(u=>{u.code===v.SUCCESS?(d.success("\u5220\u9664\u6210\u529F"),R()):d.error("\u5220\u9664\u5931\u8D25")})}})}function De(e){return h(this,null,function*(){b=e.id,L.value=`\u5206\u914D ${e.roleName} \u7684\u83DC\u5355\u6743\u9650`,F.value=e.menu_keys,_.value=!0;let u=yield Pe(e.id);F.value=u.data,console.log("%c \u{1F370} handleMenuAuth: ","font-size:20px;background-color: #7F2B82;color:#fff;",u)})}function be(e){console.log("%c \u{1F350} keys: ","font-size:20px;background-color: #E41A6A;color:#fff;",e),F.value=[...e]}function ye(e){D.value=e}function Ce(){D.value.length?D.value=[]:D.value=p.menus.map(e=>e.id)}function K(){N.value?(F.value=[],N.value=!1):(F.value=Ke(p.menus),N.value=!0)}return Xe(()=>h(this,null,function*(){})),(e,u)=>{const i=eu,ke=uu,y=ou,Ee=tu,Be=lu,V=nu,O=au,U=su,Se=ru,xe=cu;return X(),Ze("div",null,[mu,o(Ee,{bordered:!1,class:"mt-4 proCard"},{default:t(()=>[o(n($e),{onRegister:n(te),onSubmit:ce,onReset:ie},{statusSlot:t(({model:c,field:$})=>[o(i,{value:c[$],"onUpdate:value":Ae=>c[$]=Ae},null,8,["value","onUpdate:value"])]),_:1},8,["onRegister"]),o(n(Ie),{columns:ne,request:se,"row-key":c=>c.id,ref_key:"actionRef",ref:k,actionColumn:n(ae),"onUpdate:checkedRowKeys":re},{tableTitle:t(()=>[n(r)(["add_role"])?(X(),Je(y,{key:0,type:"primary",onClick:_e},{icon:t(()=>[o(ke,null,{default:t(()=>[o(n(Qe))]),_:1})]),default:t(()=>[gu]),_:1})):Ye("",!0)]),action:t(()=>[o(n(G))]),_:1},8,["row-key","actionColumn"])]),_:1}),o(O,{show:_.value,"onUpdate:show":u[0]||(u[0]=c=>_.value=c),"show-icon":!1,preset:"dialog",title:L.value,style:{width:"800px"}},{action:t(()=>[o(V,null,{default:t(()=>[o(y,{type:"info",ghost:"","icon-placement":"left",onClick:Ce},{default:t(()=>[C(" \u5168\u90E8"+Z(D.value.length?"\u6536\u8D77":"\u5C55\u5F00"),1)]),_:1}),o(y,{type:"info",ghost:"","icon-placement":"left",onClick:K},{default:t(()=>[C(" \u5168\u90E8"+Z(N.value?"\u53D6\u6D88":"\u9009\u62E9"),1)]),_:1}),o(y,{class:"min-btn",type:"primary",loading:m.value,onClick:me},{default:t(()=>[Fu]),_:1},8,["loading"])]),_:1})]),default:t(()=>[Y("div",_u,[o(Be,{"block-line":"",cascade:!0,checkable:"","virtual-scroll":!0,data:n(p).menus,"key-field":"id","label-field":"name",expandedKeys:D.value,"checked-keys":F.value,style:{"max-height":"950px",overflow:"hidden"},"onUpdate:checkedKeys":be,"onUpdate:expandedKeys":ye},null,8,["data","expandedKeys","checked-keys"])])]),_:1},8,["show","title"]),o(O,{show:f.value,"onUpdate:show":u[5]||(u[5]=c=>f.value=c),"show-icon":!1,title:T.value,preset:"card",style:{width:"800px"}},{footer:t(()=>[o(V,{justify:"end"},{default:t(()=>[o(y,{class:"min-btn",type:"info",ghost:"","icon-placement":"left",onClick:K},{default:t(()=>[hu]),_:1}),o(y,{type:"primary",class:"min-btn",loading:m.value,onClick:de},{default:t(()=>[vu]),_:1},8,["loading"])]),_:1})]),default:t(()=>[o(xe,{"label-width":120,model:n(s),rules:ue,"label-placement":"left",ref_key:"formRef",ref:A},{default:t(()=>[o(U,{label:"\u89D2\u8272\u540D\u79F0",path:"roleName"},{default:t(()=>[o(i,{value:n(s).roleName,"onUpdate:value":u[1]||(u[1]=c=>n(s).roleName=c),placeholder:"\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["value"])]),_:1}),o(U,{label:"\u89D2\u8272\u63CF\u8FF0",path:"roleDesc"},{default:t(()=>[o(i,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0",type:"textarea",value:n(s).roleDesc,"onUpdate:value":u[2]||(u[2]=c=>n(s).roleDesc=c)},null,8,["value"])]),_:1}),o(U,{label:"\u6240\u5C5E\u5E73\u53F0",path:"appId"},{default:t(()=>[o(Se,{value:n(s).appId,"onUpdate:value":u[3]||(u[3]=c=>n(s).appId=c),options:n(p).tenantList,onChange:he},null,8,["value","options"])]),_:1}),o(U,{label:"\u542F\u7528\u7981\u7528\u72B6\u6001"},{default:t(()=>[o(n(J),{value:n(s).status,"onUpdate:value":u[4]||(u[4]=c=>n(s).status=c),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}});export{Au as default};
